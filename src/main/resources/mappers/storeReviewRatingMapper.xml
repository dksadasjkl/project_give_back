<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.give.repository.StoreReviewRatingMapper">

    <resultMap id="StoreReviewRatingMap" type="com.project.give.entity.StoreReviewRating">
        <id property="ratingId" column="rating_id"/>
        <result property="commentId" column="comment_id"/>
        <result property="userId" column="user_id"/>
        <result property="rating" column="rating"/>
        <result property="createDate" column="create_date"/>
    </resultMap>

    <!-- ⭐ 별점 등록 -->
    <insert id="insertRating" parameterType="com.project.give.entity.StoreReviewRating">
        INSERT INTO store_review_rating_tb
        (comment_id, user_id, rating, create_date)
        VALUES (#{commentId}, #{userId}, #{rating}, NOW());
    </insert>

    <!-- ⭐ 댓글(리뷰)별 평균 별점 -->
    <select id="selectAverageRatingByComment" resultType="double">
        SELECT IFNULL(AVG(rating), 0)
        FROM store_review_rating_tb
        WHERE comment_id = #{commentId};
    </select>

    <!-- ⭐ 사용자별 평가 여부 확인 -->
    <select id="existsRatingByUser" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM store_review_rating_tb
        WHERE comment_id = #{commentId}
        AND user_id = #{userId};
    </select>

</mapper>
